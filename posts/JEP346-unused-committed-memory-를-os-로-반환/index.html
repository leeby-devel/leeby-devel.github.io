<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="JEP 346 &gt; unused (미사용) committed memory 를 OS 로 반환 (feat. 인프라 비용 절감)" /><meta property="og:locale" content="en" /><meta name="description" content="들어가며… 최근 회사에서 JDK, Spring Boot, Kotlin, Gradle 등 기반 시스템 버전 업그레이드하는 작업을 주도했다. 그 중 JDK 버전은 11 → 17, 17 → 21 두 단계로 진행할 계획이었고, 계획대로 JDK 17 부터 버전 업데이트를 했다. 업데이트 후 애플리케이션 메트릭을 살펴보는데 Heap 메모리 풋프린트가 이전과 다른 양상을 보였고, 이번 포스트에서 해당 내용을 다뤄보고자 한다." /><meta property="og:description" content="들어가며… 최근 회사에서 JDK, Spring Boot, Kotlin, Gradle 등 기반 시스템 버전 업그레이드하는 작업을 주도했다. 그 중 JDK 버전은 11 → 17, 17 → 21 두 단계로 진행할 계획이었고, 계획대로 JDK 17 부터 버전 업데이트를 했다. 업데이트 후 애플리케이션 메트릭을 살펴보는데 Heap 메모리 풋프린트가 이전과 다른 양상을 보였고, 이번 포스트에서 해당 내용을 다뤄보고자 한다." /><link rel="canonical" href="https://leeby-devel.github.io/posts/JEP346-unused-committed-memory-%EB%A5%BC-os-%EB%A1%9C-%EB%B0%98%ED%99%98/" /><meta property="og:url" content="https://leeby-devel.github.io/posts/JEP346-unused-committed-memory-%EB%A5%BC-os-%EB%A1%9C-%EB%B0%98%ED%99%98/" /><meta property="og:site_name" content="작심삼일 블로그" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-11-10T21:39:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JEP 346 &gt; unused (미사용) committed memory 를 OS 로 반환 (feat. 인프라 비용 절감)" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="sGZlAxCFoyiY1YBBAqfGj5urtMWcA4HzjhZvcJAajOU" /> <script type="application/ld+json"> {"dateModified":"2024-11-12T10:38:06+09:00","datePublished":"2024-11-10T21:39:00+09:00","description":"들어가며… 최근 회사에서 JDK, Spring Boot, Kotlin, Gradle 등 기반 시스템 버전 업그레이드하는 작업을 주도했다. 그 중 JDK 버전은 11 → 17, 17 → 21 두 단계로 진행할 계획이었고, 계획대로 JDK 17 부터 버전 업데이트를 했다. 업데이트 후 애플리케이션 메트릭을 살펴보는데 Heap 메모리 풋프린트가 이전과 다른 양상을 보였고, 이번 포스트에서 해당 내용을 다뤄보고자 한다.","mainEntityOfPage":{"@type":"WebPage","@id":"https://leeby-devel.github.io/posts/JEP346-unused-committed-memory-%EB%A5%BC-os-%EB%A1%9C-%EB%B0%98%ED%99%98/"},"url":"https://leeby-devel.github.io/posts/JEP346-unused-committed-memory-%EB%A5%BC-os-%EB%A1%9C-%EB%B0%98%ED%99%98/","@type":"BlogPosting","headline":"JEP 346 &gt; unused (미사용) committed memory 를 OS 로 반환 (feat. 인프라 비용 절감)","@context":"https://schema.org"}</script><title>JEP 346 > unused (미사용) committed memory 를 OS 로 반환 (feat. 인프라 비용 절감) | 작심삼일 블로그</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="작심삼일 블로그"><meta name="application-name" content="작심삼일 블로그"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">작심삼일 블로그</a></div><div class="site-subtitle font-italic">진짜 작심삼일이 될 줄이야..</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/leeby-devel" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['leeby.devel','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/byunghun-lee/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>JEP 346 > unused (미사용) committed memory 를 OS 로 반환 (feat. 인프라 비용 절감)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>JEP 346 > unused (미사용) committed memory 를 OS 로 반환 (feat. 인프라 비용 절감)</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">leeby</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1731242340" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-11-10 </em> </span> <span> Updated <em class="timeago" data-ts="1731375486" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-11-12 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1587 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><h2 id="들어가며">들어가며… <a href="#들어가며" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>최근 회사에서 JDK, Spring Boot, Kotlin, Gradle 등 기반 시스템 버전 업그레이드하는 작업을 주도했다. 그 중 JDK 버전은 <code class="language-plaintext highlighter-rouge">11 → 17</code>, <code class="language-plaintext highlighter-rouge">17 → 21</code> 두 단계로 진행할 계획이었고, 계획대로 JDK 17 부터 버전 업데이트를 했다. 업데이트 후 애플리케이션 메트릭을 살펴보는데 Heap 메모리 풋프린트가 이전과 다른 양상을 보였고, 이번 포스트에서 해당 내용을 다뤄보고자 한다.</p><h2 id="jvm-heap-메모리">JVM Heap 메모리 <a href="#jvm-heap-메모리" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>먼저 JVM 힙메모리 상태에 대한 용어부터 짚고 가는 게 좋을 것 같다. <strong>Grafana JVM Micrometer 기준</strong>으로 JVM 힙 메모리는 <code class="language-plaintext highlighter-rouge">used</code>, <code class="language-plaintext highlighter-rouge">committed</code>, <code class="language-plaintext highlighter-rouge">max</code> (= reserved) 로 나뉜다.</p><p><img width="800" alt="jvm-micrometer" data-src="https://github.com/user-attachments/assets/b6ce583d-4a84-41eb-b208-276722b76c82" data-proofer-ignore> <em>committed == max 인 상태</em></p><blockquote><ul><li><code class="language-plaintext highlighter-rouge">used</code>: 애플리케이션 힙의 라이브 오브젝트들에 의해 점유되고 있는 메모리이다.<li><code class="language-plaintext highlighter-rouge">RSS (of heap)</code>: 애플리케이션이 물리적으로 (실제로) 점유하고 있는 메모리 영역이다. Grafana 에서 표현되지 않으므로 대충 가상의 선을 그었다. committed 영역에서 실제로 사용중인 부분으로 이해하면 된다. pmap 으로 관찰 가능하다.<li><code class="language-plaintext highlighter-rouge">committed</code>: 애플리케이션이 OS 로 부터 미리 할당받아 놓은 메모리 영역이다. 실제로 사용(RSS)되고 있을 수도 있고 아닐 수도 있다. reserved 까지 확장될 수 있다.<li><code class="language-plaintext highlighter-rouge">reserved</code> (= max): 애플리케이션이 OS 로부터 할당받을 수 있는 메모리의 최대 크기이다.</ul><p><em>ref. <a href="https://stackoverflow.com/a/31178912" target="_blank">https://stackoverflow.com/a/31178912</a></em></p></blockquote><h2 id="기존-jdk-11-까지의-메모리-설정">기존 (JDK 11) 까지의 메모리 설정 <a href="#기존-jdk-11-까지의-메모리-설정" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>JDK 11 까지는 <code class="language-plaintext highlighter-rouge">InitialRAMPercentage</code> 를 <code class="language-plaintext highlighter-rouge">MaxRAMPercentage</code> 와 같게 두거나, <code class="language-plaintext highlighter-rouge">xms</code> 값을 <code class="language-plaintext highlighter-rouge">xmx</code> 값과 같게 두는 것이 권장되었다. 그 이유는 다음과 같은 오버헤드를 피하기 위해서였다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>committed 크기가 작다.
→ GC 주기가 짧아지고 이는 오버헤드로 작용한다.

committed 크기가 reserved 와 달라 필요에 따라 reserved 까지 점진적으로 크기가 확장된다.
→ OS 로부터 메모리를 할당받는 과정에서 오버헤드가 발생한다.
</pre></table></code></div></div><details> <summary><strong>👉 부연 설명</strong></summary> (G1GC 기준) GC Cycle 은 committed 메모리 범위 내에서 수행된다. 따라서 committed 메모리 크기가 작으면 그 만큼 GC 주기가 짧아진다. 엄밀하게는 GC Cycle 은 사용중인 메모리 (RSS) 범위 내에서 수행되고 추가 메모리가 필요하면 RSS 가 committed 만큼 확장되는 것이다. 이후에 committed 메모리로도 부족하면 OS 에 추가 메모리를 요청하고, 이 크기는 reserved 만큼 늘어날 수 있다. </details><p><br /> 중요한 점은, <strong>JDK 11 까지는 한번 committed 된 메모리는 (특별한 경우가 아니면) OS 로 반환되지 않는다</strong>는 점이다.</p><p>예를 들어, 위 설정과 다르게 <code class="language-plaintext highlighter-rouge">InitialRAMPercentage</code> 값을 낮게 설정했더라도 트래픽이 많은 시간대에서 확장된 메모리 크기는 트래픽이 적은 새벽이 된다고 해서 줄어들지 않는다. 즉 앱이 에이징 됨에 따라 committed 메모리는 reserved 까지 계속해서 증가하는 양상을 띄게 된다. (트래픽이 있는 애플리케이션이라면)</p><h2 id="jep-346--메모리-관리-패턴-개선-사항">JEP 346 &gt; 메모리 관리 패턴 개선 사항 <a href="#jep-346--메모리-관리-패턴-개선-사항" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><strong>이러한 메모리 사용 패턴은 사용량만큼 비용을 지불하는 클라우드 환경에서는 큰 단점</strong>으로 작용한다. JEP 346 에서는 이러한 점을 개선하기 위해, <strong>유휴 committed 메모리는 OS 로 반환되도록 G1GC 의 메모리 사용 패턴에 변화</strong>를 줬다. 위 내용은 <strong>“<a href="https://openjdk.org/jeps/346" target="_blank">JEP 346</a> &gt; Motivation”</strong> 에 잘 나와있다.</p><p>JEP 346 개선사항은 <strong>JDK 12 부터 적용</strong>되었기 때문에 <code class="language-plaintext highlighter-rouge">JDK 11 → 17</code> 업데이트 이후에 현상을 발견한 것이었다.</p><h3 id="개선-전후-메트릭-비교"><strong>개선 전후 메트릭 비교</strong> <a href="#개선-전후-메트릭-비교" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>다음은 JDK 버전 외에 JVM 설정 값 등 모든 환경이 같은 동일 애플리케이션 메트릭이다.</p><p><img width="800" alt="before-jdk12" data-src="https://github.com/user-attachments/assets/09f9470a-16ff-47c5-a4a0-a8ee2c49fa7d" data-proofer-ignore> <em>JDK &lt;= 11</em></p><p><img width="800" alt="after-jdk12" data-src="https://github.com/user-attachments/assets/f93354b0-0d04-4198-8a63-952e3408c468" data-proofer-ignore> <em>JDK &gt;= 12 → 미사용 committed 메모리가 OS 로 반환되는 모습을 볼 수 있다.</em></p><p>두 환경 모두 <code class="language-plaintext highlighter-rouge">InitialRAMPercentage</code>, <code class="language-plaintext highlighter-rouge">MaxRAMPercentage</code> 두 값을 동일하게 75% 로 두었다. 눈여겨 볼 점은 <strong>JDK &gt;= 12 에서는 <code class="language-plaintext highlighter-rouge">InitialRAMPercentage</code> 옵션이 기대와 같이 동작하지 않는 다는 점</strong>이다. 예상 대로면 committed, reserved (= max) 풋프린트가 같아야 하기 때문이다.</p><h3 id="initialrampercentage-사용성-이해"><strong>InitialRAMPercentage 사용성 이해</strong> <a href="#initialrampercentage-사용성-이해" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote class="prompt-note"><div><p><strong>JEP 346 &gt; Risks and Assumptions</strong></p><p>When this feature (이번 개선 사항) is enabled, the VM runs these periodic collections under the conditions above regardless of other options. E.g. the VM could make an assumption that if the user sets -Xms to -Xmx and other (combinations of) options to get minimal and consistent garbage collection pauses. This will not be the case for consistency reasons.</p></div></blockquote><p>이는 <strong>JEP 346 에서 메모리 관리 기능이 변경되었고 이 기능이 우선</strong>되어 <code class="language-plaintext highlighter-rouge">InitialRAMPercentage</code> 를 아무리 높게 설정하여도 실제 사용되지 않는 메모리는 committed 풋프린트로 잡히지 않게 된 것이다. 따라서 <strong>JDK 12 이후부터는 <code class="language-plaintext highlighter-rouge">InitialRAMPercentage</code> 값을 <code class="language-plaintext highlighter-rouge">MaxRAMPercentage</code> 값과 같게 (= 높게) 두는 것은 아무 의미가 없어졌다.</strong></p><p>다만 <code class="language-plaintext highlighter-rouge">InitialRAMPercentage</code> 옵션은 여전히 초기 힙 메모리를 설정하는 옵션으로서 의미가 있다. JEP 346 개선사항으로 인해 <code class="language-plaintext highlighter-rouge">InitialRAMPercentage</code> 옵션이 직접적으로 변경된 것은 아니지만 간접적인 영향을 받았고, <strong>옵션의 사용 맥락에 있어 약간의 변화가 생겼다고 이해</strong>하면 될 것 같다.</p><p>필요할 때만 메모리를 확장하고 필요없을 때는 OS 로 메모리를 반환하는 패턴은 결과적으로 Worker Node 관점에서의 메모리 풋프린트를 크게 줄여줬다. (애플리케이션에 따라 대략 60% ~ 30% 정도)</p><p>JEP 346 개선사항은 클라우드 환경이 너무 당연한 요즘, 인프라 비용을 절감할 수 있는 아주 매력적인 피쳐라는 생각이 든다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/jvm/'>JVM</a>, <a href='/categories/gc/'>GC</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/jep/" class="post-tag no-text-decoration" >JEP</a> <a href="/tags/jvm/" class="post-tag no-text-decoration" >JVM</a> <a href="/tags/jdk/" class="post-tag no-text-decoration" >JDK</a> <a href="/tags/g1gc/" class="post-tag no-text-decoration" >G1GC</a> <a href="/tags/gc/" class="post-tag no-text-decoration" >GC</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JEP 346 &gt; unused (미사용) committed memory 를 OS 로 반환 (feat. 인프라 비용 절감) - 작심삼일 블로그&amp;url=https://leeby-devel.github.io/posts/JEP346-unused-committed-memory-%EB%A5%BC-os-%EB%A1%9C-%EB%B0%98%ED%99%98/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JEP 346 &gt; unused (미사용) committed memory 를 OS 로 반환 (feat. 인프라 비용 절감) - 작심삼일 블로그&amp;u=https://leeby-devel.github.io/posts/JEP346-unused-committed-memory-%EB%A5%BC-os-%EB%A1%9C-%EB%B0%98%ED%99%98/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://leeby-devel.github.io/posts/JEP346-unused-committed-memory-%EB%A5%BC-os-%EB%A1%9C-%EB%B0%98%ED%99%98/&amp;text=JEP 346 &gt; unused (미사용) committed memory 를 OS 로 반환 (feat. 인프라 비용 절감) - 작심삼일 블로그" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="leeby-devel/leeby-devel.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/JEP346-unused-committed-memory-%EB%A5%BC-os-%EB%A1%9C-%EB%B0%98%ED%99%98/">JEP 346 > unused (미사용) committed memory 를 OS 로 반환 (feat. 인프라 비용 절감)</a><li><a href="/posts/JVM-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%88%84%EC%88%98-Native-%EB%A9%94%EB%AA%A8%EB%A6%AC-glibc-malloc/">JVM 메모리 누수 > Native 메모리 > glibc malloc</a><li><a href="/posts/JVM-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%88%84%EC%88%98-Heap-lettuce/">JVM 메모리 누수 > Heap > lettuce</a><li><a href="/posts/k8s-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%ED%8C%A8%ED%82%B7-%EC%BA%A1%EC%B3%90%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95/">k8s 환경에서 패킷 캡쳐하는 방법 > tcpdump, wireshark</a><li><a href="/posts/JVM-Container-Awareness-Bug-cgroup-v2-JDK-11.0.16/">JVM Container Awareness Bug (cgroup v2) > JDK 11.0.16</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/jdk/">JDK</a> <a class="post-tag" href="/tags/jvm/">JVM</a> <a class="post-tag" href="/tags/jcmd/">jcmd</a> <a class="post-tag" href="/tags/leak/">leak</a> <a class="post-tag" href="/tags/c/">C</a> <a class="post-tag" href="/tags/cgroup/">cgroup</a> <a class="post-tag" href="/tags/container-awareness/">Container Awareness</a> <a class="post-tag" href="/tags/dispatcherservlet/">DispatcherServlet</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/g1gc/">G1GC</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/JVM-Container-Awareness-Bug-cgroup-v2-JDK-11.0.16/"><div class="card-body"> <em class="timeago small" data-ts="1667634840" > 2022-11-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JVM Container Awareness Bug (cgroup v2) > JDK 11.0.16</h3><div class="text-muted small"><p> 저처럼 글 읽기를 싫어하시는 분들을 위한 결론 Kubernetes 환경에서 JDK 11 을 사용중이라면 JDK 11.0.16 이상의 버전 사용을 권장한다. JDK 12 - 14 버전을 사용중이라면 15 이상의 버전 사용을 권장한다. 그렇지 않으면 소중한 Pod 가 OOMKilled 당할 수 있다. 특히 Init...</p></div></div></a></div><div class="card"> <a href="/posts/JVM-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%88%84%EC%88%98-Heap-lettuce/"><div class="card-body"> <em class="timeago small" data-ts="1712923200" > 2024-04-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JVM 메모리 누수 > Heap > lettuce</h3><div class="text-muted small"><p> 최근 회사 애플리케이션의 JVM 메모리 누수를 찾아낸 뒤 픽스했다. 과정을 정리해두면 메모리 누수를 또 찾고 있을 미래의 나에게도 도움이 될 것 같아 정리해본다. 트러블 슈팅 배경 애플리케이션 파드가 일정 시간 이상 에이징이 되면 RESTART 되고 있다. 사내 메트릭 분석 툴에 힙 히스토그램을 시계열로 분석할 수 있는 기능이 있어 이를 활용해봤다...</p></div></div></a></div><div class="card"> <a href="/posts/JVM-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%88%84%EC%88%98-Native-%EB%A9%94%EB%AA%A8%EB%A6%AC-glibc-malloc/"><div class="card-body"> <em class="timeago small" data-ts="1721303640" > 2024-07-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JVM 메모리 누수 > Native 메모리 > glibc malloc</h3><div class="text-muted small"><p> 몇 개월 전에 회사 애플리케이션에서 발생한 메모리 누수를 트러블 슈팅 &amp;amp; 픽스한 내용을 포스트로 다루었다. 누수를 잡아낸 후에도 미량이지만 애플리케이션 전체 메모리 사용량 (RSS 기준)이 계속해서 늘어나고 있었다. 원인을 파헤쳐보니 크리티컬한 내용은 아니나, GNU C 라이브러리 (glibc) 위에 구동되는 JVM 은 알게 모르게 영향을 받...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/k8s-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%ED%8C%A8%ED%82%B7-%EC%BA%A1%EC%B3%90%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95/" class="btn btn-outline-primary" prompt="Older"><p>k8s 환경에서 패킷 캡쳐하는 방법 > tcpdump, wireshark</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/username">leeby</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/jdk/">JDK</a> <a class="post-tag" href="/tags/jvm/">JVM</a> <a class="post-tag" href="/tags/jcmd/">jcmd</a> <a class="post-tag" href="/tags/leak/">leak</a> <a class="post-tag" href="/tags/c/">C</a> <a class="post-tag" href="/tags/cgroup/">cgroup</a> <a class="post-tag" href="/tags/container-awareness/">Container Awareness</a> <a class="post-tag" href="/tags/dispatcherservlet/">DispatcherServlet</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/g1gc/">G1GC</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-FM1HTHQVZ8"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-FM1HTHQVZ8'); }); </script>
